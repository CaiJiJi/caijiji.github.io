<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Information_In_Pentest | 阔落阔西</title>

  
  <meta name="author" content="Caijjjjj">
  

  
  <meta name="description" content="爱喝阔落，十分阔西">
  

  
  
  <meta name="keywords" content="Pentest">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Information_In_Pentest">

  <meta property="og:site_name" content="阔落阔西">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="阔落阔西" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">阔落阔西</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Information_In_Pentest</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/06/06/2019-06-06-Information-In-Pentest/" rel="bookmark">
        <time class="entry-date published" datetime="2019-06-06T09:00:43.000Z">
          2019-06-06
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1><span id="资产搜集">资产搜集</span></h1><p>　在面对大型互联网企业/zf单位，我们所面对的资产不再是单一的网站/ip/域名，所以面对大型目标时候，你本身资产搜集习惯也是决定后续渗透过程走的深度。</p>
<!-- toc -->
<ul>
<li><a href="#dns信息收集">dns信息收集</a><ul>
<li><a href="#渗透中常利用的dns解析记录中有">渗透中常利用的dns解析记录中有</a></li>
<li><a href="#域传输漏洞">域传输漏洞</a></li>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#域名备案信息国内">域名备案信息(国内)</a></li>
<li><a href="#whois-reverse">Whois Reverse</a></li>
<li><a href="#企业信息投资关系">企业信息/投资关系</a></li>
<li><a href="#合作伙伴开发商供应商">合作伙伴/开发商/供应商</a></li>
<li><a href="#ip方向的资产搜集">IP方向的资产搜集</a></li>
<li><a href="#移动端">移动端</a></li>
<li><a href="#子域名爆破搜集">子域名爆破/搜集</a></li>
<li><a href="#some-example">some example</a><ul>
<li><a href="#0x01-幻想过程一">0x01 幻想过程一</a></li>
<li><a href="#0x02-幻想过程二">0x02 幻想过程二</a></li>
<li><a href="#0x03-幻想过程三">0x03 幻想过程三</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<a id="more"></a>
<p><br></p>
<h3><span id="dns信息收集">dns信息收集</span></h3><p><br></p>
<h4><span id="渗透中常利用的dns解析记录中有">渗透中常利用的dns解析记录中有</span></h4><table>
<thead>
<tr>
<th>记录类型</th>
<th>简介</th>
</tr>
</thead>
<tbody>
<tr>
<td>A记录</td>
<td>返回当前域名解析的IPv4地址</td>
</tr>
<tr>
<td>CNAME</td>
<td>返回当前域名解析的别名</td>
</tr>
<tr>
<td>AAAA</td>
<td>返回当前域名解析的IPv6地址</td>
</tr>
<tr>
<td>SOA</td>
<td>返回当前域名解析的别名</td>
</tr>
<tr>
<td>MX</td>
<td>返回当前域名邮件交换记录</td>
</tr>
<tr>
<td>NS</td>
<td>返回当前域名采用的域名服务器</td>
</tr>
<tr>
<td>TXT</td>
<td>提供一些特殊的文本如SPF,DKIM,DMARC,甚至可能存在一些dns服务器的版本信息等</td>
</tr>
<tr>
<td>PTR</td>
<td>A记录的逆记录，根据ip返回域名</td>
</tr>
<tr>
<td>SRV</td>
<td>返回服务定位资源记录,如域控，VOIP,通常包含服务的名字，所使用的协议</td>
</tr>
<tr>
<td>SOA</td>
<td>返回域名的权威解析记录，当NS记录都没有找到该域名记录，就会去SOA记录进行搜索</td>
</tr>
</tbody>
</table>
<h4><span id="域传输漏洞">域传输漏洞</span></h4><p>由于一个公司肯定不允许只有一台域名服务器，不同的域名服务器需要同步解析记录，就需要使用axfr，如果配置不当允许任意client查询就会产生域传输漏洞。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">➜ /home/klkx&gt;dig @dns2.hncc.edu.cn axfr hncc.edu.cn     </span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; @dns2.hncc.edu.cn axfr hncc.edu.cn</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">hncc.edu.cn.	600	IN	SOA	dns.hncc.edu.cn. root.hncc.edu.cn. 2019060600 28800 14400 3600000 7200</span><br><span class="line">hncc.edu.cn.	600	IN	MX	5 mail.hncc.edu.cn.</span><br><span class="line">hncc.edu.cn.	600	IN	MX	10 mail1.hncc.edu.cn.</span><br><span class="line">hncc.edu.cn.	600	IN	NS	dns.hncc.edu.cn.</span><br><span class="line">hncc.edu.cn.	600	IN	NS	dns2.hncc.edu.cn.</span><br><span class="line">3y3s.hncc.edu.cn.	600	IN	A	125.219.124.36</span><br><span class="line">auto.hncc.edu.cn.	600	IN	A	125.219.124.34</span><br><span class="line">bwc.hncc.edu.cn.	600	IN	A	125.219.124.36</span><br><span class="line">cachedns.hncc.edu.cn.	600	IN	A	125.219.124.114</span><br><span class="line">cwc.hncc.edu.cn.	600	IN	A	125.219.124.36</span><br><span class="line">danzhao.hncc.edu.cn.	600	IN	A	42.228.9.8</span><br><span class="line">db.hncc.edu.cn.	600	IN	A	125.219.124.36</span><br><span class="line">ddh.hncc.edu.cn.	600	IN	A	125.219.124.36</span><br><span class="line">disk.hncc.edu.cn.	600	IN	A	42.228.9.7</span><br><span class="line">dns.hncc.edu.cn.	600	IN	A	125.219.124.8</span><br><span class="line">dns2.hncc.edu.cn.	600	IN	A	125.219.124.18</span><br><span class="line">dpstar.hncc.edu.cn.	600	IN	A	125.219.124.34</span><br><span class="line">edf.hncc.edu.cn.	600	IN	A	125.219.124.36</span><br><span class="line">....</span><br></pre></td></tr></table></figure></p>
<h4><span id="example">Example</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">➜ /home/klkx/ &gt;dig any baidu.com    </span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">baidu.com.	5932	IN	TXT	&quot;v=spf1 include:spf1.baidu.com include:spf2.baidu.com include:spf3.baidu.com a mx ptr -all&quot;</span><br><span class="line">baidu.com.	5932	IN	TXT	&quot;google-site-verification=GHb98-6msqyx_qqjGl5eRatD3QTHyVB6-xQ3gJB5UwM&quot;</span><br><span class="line">baidu.com.	5932	IN	MX	20 jpmx.baidu.com.</span><br><span class="line">baidu.com.	5932	IN	MX	10 mx.maillb.baidu.com.</span><br><span class="line">baidu.com.	5932	IN	MX	20 mx1.baidu.com.</span><br><span class="line">baidu.com.	5932	IN	MX	15 mx.n.shifen.com.</span><br><span class="line">baidu.com.	5932	IN	MX	20 mx50.baidu.com.</span><br><span class="line">baidu.com.	5932	IN	SOA	dns.baidu.com. sa.baidu.com. 2012140900 300 300 2592000 7200</span><br><span class="line">baidu.com.	85	IN	A	123.125.114.144</span><br><span class="line">baidu.com.	85	IN	A	220.181.38.148</span><br><span class="line">baidu.com.	86395	IN	NS	ns3.baidu.com.</span><br><span class="line">baidu.com.	86395	IN	NS	ns7.baidu.com.</span><br><span class="line">baidu.com.	86395	IN	NS	ns4.baidu.com.</span><br><span class="line">baidu.com.	86395	IN	NS	dns.baidu.com.</span><br><span class="line">baidu.com.	86395	IN	NS	ns2.baidu.com.</span><br></pre></td></tr></table></figure>
<p>可以看到百度的邮件服务器，ns服务器，spf地址，SOA记录，这样为后续确认关键网段定下了基础。</p>
<p>ns服务器的TXT记录一般可能会存在版本信息(如果是用bind进行搭建的)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dig txt chaos version.bind @ns7.baidu.com</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">version.bind.	0	CH	TXT	&quot;baidu dns&quot;</span><br></pre></td></tr></table></figure>
<p>而百度主站采用的域名跳转，可以获取到百度另外一个子域名shifen.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.baidu.com.	387	IN	CNAME	www.a.shifen.com.</span><br></pre></td></tr></table></figure>
<p>渗透中SRV记录在后续内网/关键服务渗透也是十分重要的，这里SRV爆破推荐使用dnsrecon。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[*] Enumerating SRV Records</span><br><span class="line">[*] SRV _sip._udp.alibaba-inc.com vcse-hzbj.alibaba-inc.com 42.120.73.221 5060 10</span><br><span class="line">[*] SRV _sip._udp.alibaba-inc.com vcse-xx.alibaba-inc.com 42.120.74.45 5060 10</span><br><span class="line">[*] SRV _h323cs._tcp.alibaba-inc.com vcse-hzbj.alibaba-inc.com 42.120.73.221 1720 10</span><br><span class="line">[*] SRV _h323cs._tcp.alibaba-inc.com vcse-xx.alibaba-inc.com 42.120.74.45 1720 10</span><br><span class="line">[*] SRV _h323ls._udp.alibaba-inc.com vc.alibaba-inc.com 42.120.74.45 1719 0</span><br><span class="line">[*] SRV _caldavs._tcp.alibaba-inc.com caldav.alibaba-inc.com 140.205.121.207 443 5</span><br><span class="line">[*] SRV _sip._tcp.alibaba-inc.com vcse-hzbj.alibaba-inc.com 42.120.73.221 5060 10</span><br><span class="line">[*] SRV _sip._tcp.alibaba-inc.com vcse-xx.alibaba-inc.com 42.120.74.45 5060 10</span><br><span class="line">[*] SRV _sips._tcp.alibaba-inc.com expe-hzbj.alibaba-inc.com 42.120.73.222 5061 10</span><br><span class="line">[*] SRV _sips._tcp.alibaba-inc.com expe-xx.alibaba-inc.com 42.120.74.52 5061 10</span><br><span class="line">[*] SRV _sip._tls.alibaba-inc.com vc.alibaba-inc.com 42.120.74.45 5061 10</span><br></pre></td></tr></table></figure>
<p>当然最后也不要忘记tracertroute一下看看到目标站点的路由是怎么跳的，有可能也能发现目标的路由出/入口。</p>
<h3><span id="域名备案信息国内">域名备案信息(国内)</span></h3><p>由于国内正规网站都需要备案，而一个备案号可能会同时在多个网站使用，这样可以快速获取同一公司旗下的其他域名。</p>
<p><a href="https://icp.chinaz.com/" target="_blank" rel="noopener">https://icp.chinaz.com/</a></p>
<p><img src="/images/20190605/beian.png" alt></p>
<h3><span id="whois-reverse">Whois Reverse</span></h3><p> 可以根据实际情况对Whois的注册人，注册机构，注册邮箱,nameserver 进行反向Whois扩大目标资产面。</p>
<p> Ns记录Reverse(可以尝试多个网站)</p>
<p> <img src="/images/20190605/nsreverse.png" alt></p>
<p> Whois注册邮箱Reverse</p>
<p> <img src="/images/20190605/Email.png" alt></p>
<p> Whois注册机构Reverse</p>
<p> <img src="/images/20190605/Org.png" alt></p>
<p>  还有Whois中的电话跟联系地址一样可以进行Reverse查询。</p>
<p>  其实眼尖的人就会发现这些域名中出现了一些不一样的Email,域名,注册人,注册机构,所以经过简单去重判断后还是可以重复循环查询，达成最大化的目标资产搜集。</p>
<p>  当然这里要注意NS记录Reverse存在的坑点比较多，也有可能存在别人使用了目标公司的NS服务器做自己的NS记录干扰自己的资产搜集结果。</p>
<h3><span id="企业信息投资关系">企业信息/投资关系</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">企信宝</span><br><span class="line">企业信用信息查询APP</span><br><span class="line">企查查</span><br><span class="line">天眼查</span><br><span class="line">企业云数据征信中心</span><br><span class="line">信用视界</span><br><span class="line">悉知</span><br><span class="line">Crunchbase</span><br><span class="line">Wikipedia</span><br><span class="line">angel.co</span><br></pre></td></tr></table></figure>
<p>通过企业信息查询可以扩充我们对目标资产的攻击面，比如腾讯的资产，除了母公司旗下还有很多子公司跟投资机构。</p>
<p> <img src="/images/20190605/txinfo.png" alt></p>
<p>根据投资机构我们可以了解到腾讯收购的一些子公司跟即将收购的子公司，我们可以提前对目标即将收购的子公司进行攻击获取权限，</p>
<p>等腾讯全资收购内网打通后，看是否符合攻击条件再进行后续攻击。</p>
<p>这些企业查询还会为你提供企业的业务跟公众号，后续进一步对APP/公众号　进行域名/目标搜集，扩大攻击面。</p>
<p> <img src="/images/20190605/01bdff1f-2015-4b32-90b6-32b38a7ccefe.png" alt></p>
<p>而且可以不止将目标瞄准在投资的子公司，甚至可以对准目标的母公司/集团。</p>
<p>当然我们关注点不能只放在国内，angel.co，Crunchbase，Wikipedia搜集到的资产信息跟国内完全不同，并且大家的目标也不一定是国内企业。</p>
<p><a href="https://en.wikipedia.org/wiki/List_of_mergers_and_acquisitions_by_Facebook" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/List_of_mergers_and_acquisitions_by_Facebook</a> FaceBook收购的企业</p>
<p><a href="https://www.crunchbase.com/organization/tencent/acquisitions/acquisitions_list#section-acquisitions" target="_blank" rel="noopener">https://www.crunchbase.com/organization/tencent/acquisitions/acquisitions_list#section-acquisitions</a>　Tencent海外动作</p>
<p><img src="/images/20190605/9f534d39-69c8-4353-85ab-0a127a511b65.png" alt></p>
<p>当然万能的Google也是我们最好的伙伴(查询国外企业效果更好)</p>
<p><img src="/images/20190605/6835fa3a-63a2-42f1-bfcd-b6ef2fc318d5.png" alt></p>
<h3><span id="合作伙伴开发商供应商">合作伙伴/开发商/供应商</span></h3><p>在常规安全测试中，供应商/合作方/外包公司一直是一个比较容易忽略的点，</p>
<p>这里列出一些在对目标进行渗透时用来发现目标存在相关合作公司的点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">copryright </span><br><span class="line"></span><br><span class="line">meta author</span><br><span class="line"></span><br><span class="line">google/baidu/搜索引擎能找到的相关新闻信息</span><br><span class="line"></span><br><span class="line">招标公告</span><br><span class="line"></span><br><span class="line">shodan/fofa/zoomeyes</span><br><span class="line"></span><br><span class="line">新闻/内幕消息/微信群/qq群/weibo</span><br><span class="line"></span><br><span class="line">合作伙伴</span><br><span class="line"></span><br><span class="line">招聘信息</span><br><span class="line"></span><br><span class="line">公司技术栈</span><br><span class="line"></span><br><span class="line">特定资产的url path</span><br></pre></td></tr></table></figure>
<p>从这些角度或许都能找到目标供应商，合作方或者跟目标相关的一些信息，具体信息还是需要个人进行详细的判断。</p>
<p>供应链攻击一直以来是厂商最头疼的问题，因为一般的厂商都不会把防御资源应用到供应商/合作方/外包公司上面，<br>所以当我们获取目标供应商/合作方/外包公司的权限时，<br>可以获取目标的源代码，或者往目标厂商所需的产品/源代码植入Shell，<br>或者长期控制合作方的邮箱，监控他们与目标厂商的交流从中获取意想不到的资源(如VPN/内部的git/相关的组群…)。</p>
<h3><span id="ip方向的资产搜集">IP方向的资产搜集</span></h3><p>获取目标系统的ip后，第一反应就是进行whois查询，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">inetnum: 202.69.16.0 - 202.69.31.255</span><br><span class="line">netname: PINGANCOM</span><br><span class="line">descr: Shenzhen Ping An Communication Technology Co.,Ltd</span><br><span class="line">descr: 5/F Ping An Building,No.3 Ba Gua Road</span><br><span class="line">descr: Futian District,Shenzhen,China.</span><br><span class="line">admin-c: ZM1477-AP</span><br><span class="line">tech-c: ZM1478-AP</span><br><span class="line">country: CN</span><br><span class="line">mnt-by: MAINT-CNNIC-AP</span><br><span class="line">mnt-lower: MAINT-CNNIC-AP</span><br><span class="line">mnt-irt: IRT-CNNIC-CN</span><br><span class="line">status: ALLOCATED PORTABLE</span><br><span class="line">last-modified: 2016-03-03T02:36:01Z</span><br><span class="line">source: APNIC</span><br></pre></td></tr></table></figure>
<p>这里可以看到 202.69.16.0 - 202.69.31.255整个网段都是属于平安的资产.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">person: Junli Yu</span><br><span class="line">address: 5/F Ping An Building,No.3 Ba Gua Road</span><br><span class="line">address: Futian District,Shenzhen,China.</span><br><span class="line">country: CN</span><br><span class="line">phone: +86-13418620122</span><br><span class="line">e-mail: Yujunli001@pingan.com.cn</span><br><span class="line">nic-hdl: ZM1477-AP</span><br><span class="line">mnt-by: MAINT-CNNIC-AP</span><br><span class="line">last-modified: 2016-03-03T02:12:01Z</span><br><span class="line">source: APNIC</span><br></pre></td></tr></table></figure>
<p>并且可以获取属于的组织跟联系人信息，后续可以将此信息再带入whois反查中获取更多相关ip(riskiq)。</p>
<p>大型组织一般都会购买属于自己的ASN,我们可以通过bgp查询到相关的组织信息。</p>
<p><strong> <a href="https://bgp.he.net" target="_blank" rel="noopener">https://bgp.he.net</a> </strong></p>
<p><img src="/images/20190605/138690c0-8ae7-4dbf-b592-37b74bf21497.png" alt></p>
<p>通过ASN又可以获取到目标新的ip范围。</p>
<p>而且我们可以通过ip反查ASN，在看当下的ASN拥有哪些ip.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">202.69.26.13 -&gt; AS23848 -&gt; 43.230.220.0/22,45.65.20.0/22,103.50.36.0/22,103.50.38.0/24,103.210.168.0/22,103.210.168.0/24,103.210.171.0/24,202.69.16.0/20</span><br></pre></td></tr></table></figure>
<p>这样就能获取对方大范围的资产列表了，但是这也要小心云类型的ip，容易会影响我们对目标ip的判断。</p>
<p>Shodan/Censys 提供的Org命令也可以帮我们快速发现目标的其他一些网段。</p>
<p><img src="/images/20190605/18dab82c-e394-4a3e-96f1-3b4b13f25a86.png" alt></p>
<p>目标的org可以根据你之前获得的ip信息带到shodan去获取，获取到新的org名字后再继续进行查询。</p>
<p>在获取企业资产的ip后，C段方向的信息搜集也是必不可少的，除了常用的一些riskiq/sameip domain以外,免费的必应也是一个不错的选择。</p>
<p>而在Github/oschina/gitlab上也会有一些相关的域名/ip，这一点Github监控工具也已经在网上一找一大把了。</p>
<p>但是最容易被忽略的就是目前大部分监控工具都容易忘记的一点就是企业内部的域名，跟内网资源相结合形成的杀伤力可能会更加大。</p>
<p>众所周知某鹅内网存在oa.com这样的域名，如果我们在Github监控包含oa.com 存在符合10.x.x.x的内网地址的文件，那么我们会发现什么?</p>
<p><img src="/images/20190605/688340ce-ec35-49f0-a59a-13196b99ceb3.png" alt></p>
<p>某鹅某手游的模块源码，里面存在着许多敏感的信息，如果我这时候是一个想对某鹅进行APT的不良人员，那么我第一反应就是从这个点入手看能不能获取更多信息。</p>
<p>所以一个良好的信息搜集习惯会是年轻人成功拿下目标必不可少的一步。</p>
<p>当然相关的搜索语法一定是不仅仅是这样的，信息搜集靠的也是参与人的集思广益。</p>
<p>其实Git+内部域名/内网ip的方式，在我们获取目标的内网入口后，再重新进行一起探测，则会更有利与自己在目标内网进行横向渗透，关键目标渗透。</p>
<h3><span id="移动端">移动端</span></h3><p>随着移动端的兴起，很多单位都有自己的移动APP、微信公众号、QQ群等，这也是值得重点关注的点。</p>
<p>微信公众号在企查查等网站可以搜到一些绑定了企业信息的公众号，很方便我们个人进行目标的资产搜集。</p>
<p><img src="/images/20190605/0ef51408-9133-4748-ab9c-5f61de1241cb.png" alt></p>
<p>但是如果没有经过企业认证的公众号就不会显示在企查查的页面中，可能还需要我们个人在微信接口上面搜索企业相关关键字/企业软文/微信文章内的关键字来获取一些不一样的目标接口跟资产信息。</p>
<p>而移动App除了市面上可以搜索到的一些APP,</p>
<p>我们针对的大型企业大部分都会开发属于自己员工进行内网通信,同事协同交流之类的办公协同APP,</p>
<p>这也是一个很重要的入口点，可以找找相关的目标的一些入职培训，入职公告，或者weibo/twitter一些员工发的入职牢骚，往往能得到这些特殊APP名称/下载地址，实在不行伪装成萌新去问，一般的员工都不会认为企业内部的通讯APP分享给一个新员工有什么问题，也都会分享给你的。</p>
<p>如果能搞定这个APP，那么就可以获取目标员工信息/内网入口等。</p>
<p>针对目标企业相关的QQ群也是一个很重要的点，虽然现在办公大部分都转移到了wechat/dingtalk/自建平台等，但是由于历史的原因还是有很多企业的事业群依然采用QQ进行沟通交流，而QQ群默认都是允许搜索到的。</p>
<p>这样我们搜索到目标相关QQ群，可以伪装成xx部新入职小王，这样不容易被人怀疑的理由申请加群，大部分都会通过的。那么群内的公告，群共享，聊天记录，通讯录对一个不怀好意的人来说更是一笔可观的资产资源。</p>
<h3><span id="子域名爆破搜集">子域名爆破/搜集</span></h3><p>这是一个古老而又不得不提到的点，网上爆破工具五花八门，每个人选取自己喜欢的工具即可。</p>
<p>这里推荐几个第三方获取域名的接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">https://www.ask.com/web?q=site:%s&amp;o=0&amp;qo=homepageSearchBox&amp;page=%s</span><br><span class="line">http://www.baidu.com/s?wd=site:%s&amp;pn=%s</span><br><span class="line">https://www.bing.com/search?q=site:&apos; + self.domain + &apos;&amp;first=&apos; + str(page)+&apos;&amp;FORM=PERE2</span><br><span class="line">http://alexa.chinaz.com/?domain=%s</span><br><span class="line">https://crt.sh/?q=%25.&#123;0&#125;</span><br><span class="line">http://www.dnsdb.org/%s/</span><br><span class="line">https://dnsdumpster.com/</span><br><span class="line">http://www.exalead.com/search/web/results/?q=site%3A&#123;0&#125;&amp;&amp;elements_per_page=10&amp;start_index=&#123;1&#125;</span><br><span class="line">http://www.google.com/search?q=site:%s&amp;safe=on&amp;start=%i</span><br><span class="line">https://api.hackertarget.com/hostsearch/?q=%s</span><br><span class="line">http://www.haosou.com/s?src=360sou_newhome&amp;q=site:&apos;+domain</span><br><span class="line">http://i.links.cn/subdomain/</span><br><span class="line">http://searchdns.netcraft.com/?restriction=site+contains&amp;host=*.%s&amp;lookup=wait..&amp;position=limited</span><br><span class="line">http://ptrarchive.com/tools/search.htm?label=%s</span><br><span class="line">https://api.passivetotal.org/v2/enrichment/subdomains</span><br><span class="line">https://www.threatcrowd.org/searchApi/v2/domain/report/?domain=%s</span><br><span class="line">https://www.threatminer.org/getData.php?e=subdomains_container&amp;q=%s&amp;t=0&amp;rt=10&amp;p=1</span><br><span class="line">https://www.virustotal.com/en/domain/%s/information/</span><br><span class="line">http://webscan.360.cn/sub/index/?url=&apos;+domain</span><br><span class="line">https://search.yahoo.com/search?p=site:%s&amp;pz=10&amp;b=%s</span><br><span class="line">https://findsubdomains.com/subdomains-of/%s</span><br><span class="line">censys_certificates.search</span><br><span class="line">https://urlscan.io/api/v1/search/?q=domain:%s</span><br><span class="line">https://duckduckgo.com/d.js?q=site%3A%s&amp;l=wt-wt&amp;s=0&amp;a=h_&amp;ct=CN&amp;ss_mkt=us&amp;vqd=3-271505942735536872707783476956374496418-294079616056275245052269096373311738824&amp;p_ent=&amp;ex=-1&amp;sp=%s</span><br><span class="line">https://dns.bufferover.run/dns?q=%s (也可以自己利用rdns搭建本地查询更快速)</span><br></pre></td></tr></table></figure>
<p>可以利用的接口也一定不只有这些，希望也能一直更新好用的接口。</p>
<h3><span id="some-example">some example</span></h3><h4><span id="0x01-幻想过程一">0x01 幻想过程一</span></h4><p>事情起因来自于某次资产搜集发现目标存在一处对外包暴露的管理后台　</p>
<p><a href="http://x.b.com/manager，这对于这样的问题交给大厂的src也能换上一顿午饭。" target="_blank" rel="noopener">http://x.b.com/manager，这对于这样的问题交给大厂的src也能换上一顿午饭。</a></p>
<p>但是后台底部的一处@copyright 2015@kkk，引起了我的注意，自己果断去某度搜索了kkk，发现是一家从事互联网开发的公司，并且在他的合作伙伴里面找到了b.com！<br>一个邪恶的想法就产生了。<br>于是我就把目标转换到了kkk,经过对kkk的资产探测发现了一个kaifa.kkk.com的域名，猜测这是一台开发团队的测试鸡，并且通过Google搜索得到的缓存记录也基本验证了我的想法。<br>这时候通过Github搜索kkk.com的域名获得某个开发人员的Github,并且发现他的Email,通过Email在sgk成功找到他常用的password,通过这个password登录Github发现一个私有项目，</p>
<p>私有项目一看也是kkk公司的一个即将要交付的项目，而里面的配置文件让我欣喜若狂</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&apos;REDIS_SERVER&apos; =&gt; array(</span><br><span class="line">    &apos;host&apos; =&gt; &apos;redis.kkk.com&apos;,</span><br><span class="line">    &apos;port&apos; =&gt; 26379,</span><br><span class="line">    &apos;password&apos; =&gt; &apos;rootklkx@REDIS&apos;,</span><br><span class="line">),</span><br></pre></td></tr></table></figure>
<p>一个熟悉的Redis,并且是目标kaifa.kkk.com域名的Redis密码，接下来的就是直接redis getshell 3连拿到kaifa.kkk.com权限。</p>
<p>脱下来的源码里面一共有127个客户<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ /home/klkx/Desktop/sb &gt;ls | wc -l     </span><br><span class="line">127</span><br></pre></td></tr></table></figure></p>
<p>而跟b.com的项目相关的源码也有两位数的项目，并且是时时更新的最新业务源码。</p>
<p>这个开发商至今也已经控制了1年多至今也没有发现，并且期间通过审计开发商的代码成功获取到b.com的shell一枚，可惜后面b.com的项目下线：（，不知道shell被发现了嘛？</p>
<p>但是如果是一个真的要搞b.com的坏人，拿到这些源码后对目标进行持久型的漏洞挖掘 or 植入后门，再获取b.com的敏感数据也不算一件太难的事情。</p>
<p>b.com也算是国内IT企业的领头羊，发生这样的事情，只能说国内安全任重道远啊！</p>
<p>后续当然是乖乖的删除了源码，做一个快乐的好好青年！毕竟整个过程都是幻想的。</p>
<h4><span id="0x02-幻想过程二">0x02 幻想过程二</span></h4><p>之前无聊的时候看到新闻A企业会收购某m公司，虽然我也是某m公司的资深用户，但是无聊起来连自己信息都搞。</p>
<p>想到A公司的安全实力很强大，在收购之后一定会重新帮m公司进行安全评估/安全加固。</p>
<p>所以对m公司下手也只有在收购之前下手，可能会比较容易一些。毕竟自己还是从来没有进入到A公司内网看过，所以就想好好针对一下m公司。</p>
<p>经过前期的信息搜集n.com这个域名是m公司mail等主要系统使用的域名，</p>
<p>于是对这个域名下的子域名跟关联ip进行资产探测，然后发现一处很经典的tomcat映射配置错误，成功下载到了该站点的war，</p>
<p>经过审计发现该站点登录后，可以通过上传的文件名进行命令注入。　使用china top 500 names+123456成功登录到系统里面，并且成功RCE。</p>
<p>可惜后续自己去做了其他事情，过了半把月后网站都打不开了，当然也没有进入到A公司内网　只能说是一个失败的幻想过程:(</p>
<p>通过两个幻想的案例，觉得有时候针对目标企业的攻击面也不必要只局限在传统范围，把可能性放宽广一些，那么能得到的效果可能就会更好一点，</p>
<p>这可能就是你们Pentester有趣的地方吧，同一个目标可能会有很多不同的方式来达到.</p>
<h4><span id="0x03-幻想过程三">0x03 幻想过程三</span></h4><p>等关键风头过了更新</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Pentest/">Pentest</a>
    </span>
    

    </div>

    
  </div>
</article>

  

	<section id="comment" class="comment">
		<div id="gitment"></div>
	</section>
	<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
	<script src="https://www.wenjunjiang.win/js/gitment.js"></script>
	<script>
		var gitment = new Gitment({
			owner: 'Caijiji',
			repo: 'caijiji.github.io',
			oauth: {
				client_id: 'ea0736265aacb4c172f7',
				client_secret: '428583ef41ba925834bd603ff49d04ca663761f2',
			},
		})
		gitment.render('gitment')
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    <br>
    
    &copy; 2019 Caijjjjj
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>